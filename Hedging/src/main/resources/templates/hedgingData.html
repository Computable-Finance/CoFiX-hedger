<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CoFiX Automatic Hedging Program</title>

    <style>
        .line {
            border-bottom: 0.5px dotted white;
        }
    </style>
</head>
<body class="bk">
<div style="text-align: center">
    <h2>CoFiX Automatic Hedging Program</h2>
    <div style="text-align: left;display: inline-block;">
        <p class="line"></p>
        <label>The current node: </label><label th:text=${node}></label>
        <p></p>
        <label>Wallet Address: </label><label th:text=${address}></label>
        <p></p>
        <label>Hedging interval: </label><label th:text=${interval}></label>
        <p></p>
        <label>The ethUsdtThreshold: </label><label th:text=${ethUsdtThreshold}></label>
        <p></p>
        <label>The ethHbtcThreshold: </label><label th:text=${ethHbtcThreshold}></label>
        <p></p>
        <label>The usdtThreshold: </label><label th:text=${usdtThreshold}></label>
        <p></p>
        <label>The hbtcThreshold: </label><label th:text=${hbtcThreshold}></label>
        <p></p>
        <div th:if="${proxyPort>0}">
            <p></p>
            <label>Proxy ip: </label><label th:text=${proxyIp}></label>
            <p></p>
            <label>Proxy port: </label><label th:text=${proxyPort}></label>
            <p></p>
        </div>
        <p></p>
        <p class="line"></p>

        <label>Setting up ethereum nodes (required): </label>
        <form id="updateNode">
            <input type="text" name="node" id="node" autocomplete="off">
            <input type="button" onclick="updateNode()" value="submit"/>
        </form>
      <!--  <p class="line"></p>
            <form id="updateWethAddress">
                <label>Enter  COFIX-WETH contract address (required):&nbsp;&nbsp;[[${weth}]]</label>
                <p></p>
                <input type="text" name="weth" id="weth" autocomplete="off">
                <input type="button" onclick="updateWethAddress()" value="submit"/>
            </form>
        <p class="line"></p>
            <form id="updateHbtcAddress">
                <label>Enter COFIX-HBTC-TOKEN contract address (required):&nbsp;&nbsp;[[${hbtcToken}]]</label>
                <p></p>
                <input type="text" name="token" id="hbtcToken" autocomplete="off">

                <p></p>
                <label>Enter ETH/HBTC trading pool contract address (required):&nbsp;&nbsp;[[${hbtcPair}]]</label>
                <p></p>
                <input type="text" name="pair" id="hbtcPair" autocomplete="off">

                <p></p>
                <label>Enter ETH/HBTC lock contract address (required):&nbsp;&nbsp;[[${hbtcLock}]]</label>
                <p></p>
                <input type="text" name="lock" id="hbtcLock" autocomplete="off">
                <p></p>
                <input type="button" onclick="updateHbtcAddress()" value="submit"/>
            </form>
        <p class="line"></p>
            <form id="updateUsdtAddress">
                <label>Enter COFIX-USDT-TOKEN contract address (required):&nbsp;&nbsp;[[${usdtToken}]]</label>
                <p></p>
                <input type="text" name="token" id="usdtToken" autocomplete="off">

                <p></p>
                <label>Enter ETH/USDT trading pool contract address (required):&nbsp;&nbsp;[[${usdtPair}]]</label>
                <p></p>
                <input type="text" name="pair" id="usdtPair" autocomplete="off">

                <p></p>
                <label>Enter ETH/USDT lock contract address (required):&nbsp;&nbsp;[[${usdtLock}]]</label>
                <p></p>
                <input type="text" name="lock" id="usdtLock" autocomplete="off">
                <p></p>
                <input type="button" onclick="updateUsdtAddress()" value="submit"/>
            </form>
        <p class="line"></p>-->

        <label>Set the network agent address and port (not required): </label>
        <form id="updateProxy">
            <input type="text" name="proxyIp" id="proxyIp" autocomplete="off" placeholder="Proxy IP, default is 127.0.0.1">
            <input type="text" name="proxyPort" id="proxyPort" autocomplete="off" placeholder="Proxy port, default is 0">
            <input type="button" onclick="updateProxy()" value="submit"/>
        </form>


        <label>Set up a marketmaker account address (required): </label>
        <form id="updateAddress">
            <input type="text" name="address" id="address" autocomplete="off">
            <input type="button" onclick="updateAddress()" value="submit"/>
        </form>

        <label>Set the hedging interval(default: 20s): </label>
        <form id="updateInterval">
            <input type="number" name="interval" id="interval" autocomplete="off">
            <input type="button" onclick="updateInterval()" value="submit"/>
        </form>


        <p class="line"></p>
        <form id="updateExchangeApiKey">
            <label>Enter huobi API-KEY (required)</label>
            <p></p>
            <input type="text" name="apiKey" autocomplete="off">
            <p></p>
            <label>Enter huobi API-SECRET (required)</label>
            <p></p>
            <input type="text" name="apiSecret" autocomplete="off">
            <p></p>
            <input type="button" onclick="updateExchangeApiKey()" value="submit"/>
        </form>

        <p class="line"></p>

        <form id="updateThreshold">
            <label>Enter eth/usdt threshold (The default is 1 eth)</label>
            <p></p>
            <input type="text" name="ethUsdtThreshold" id="ethUsdtThreshold" autocomplete="off">
            <p></p>
            <label>Enter eth/hbtc threshold (The default is 1 eth)</label>
            <p></p>
            <input type="text" name="ethHbtcThreshold" id="ethHbtcThreshold" autocomplete="off">
            <p></p>
            <label>Enter usdt threshold (The default is 1 usdt)</label>
            <p></p>
            <input type="text" name="usdtThreshold" id="usdtThreshold" autocomplete="off">
            <p></p>
            <label>Enter hbtc threshold (The default is 1 bhtc)</label>
            <p></p>
            <input type="text" name="hbtcThreshold" id="hbtcThreshold" autocomplete="off">
            <p></p>
            <input type="button" onclick="updateThreshold()" value="submit"/>
        </form>

<!--
        <form id="updatePasswd">
            <label>Enter user password</label>
            <p></p>
            <input type="text" name="userPasswd" id="userPasswd" autocomplete="off">
            <input type="button" onclick="updatePasswd()" value="submit"/>
        </form>
-->
    </div>

    <p class="line"/>
    <label th:text=${start}></label>
    <button onclick="startHedging()">Hedging</button>

</div>
</body>

<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript">

    function updateUsdtAddress(){

        var usdtToken = document.getElementById("usdtToken").value;
        var usdtPair = document.getElementById("usdtPair").value;
        var usdtLock = document.getElementById("usdtLock").value;
        if (!usdtToken) {
            alert("The UsdtToken address cannot be empty")
            return false;
        }
        if (!usdtPair) {
            alert("The UsdtPair address cannot be empty")
            return false;
        }

        if (!usdtLock) {
            alert("The UsdtLock address cannot be empty")
            return false;
        }

        $.ajax({
            type:"POST",
            url:"/hedging/updateUsdtAddress",
            data:$('#updateUsdtAddress').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success:function(result){
                location.replace(location);
            },
            error:function(){
                alert("Error !!")
            }
        })
    }

    function updateHbtcAddress(){

        var hbtcToken = document.getElementById("hbtcToken").value;
        var hbtcPair = document.getElementById("hbtcPair").value;
        var hbtcLock = document.getElementById("hbtcLock").value;
        if (!hbtcToken) {
            alert("The HbtcToken address cannot be empty")
            return false;
        }
        if (!hbtcPair) {
            alert("The HbtcPair address cannot be empty")
            return false;
        }

        if (!hbtcLock) {
            alert("The HbtcLock address cannot be empty")
            return false;
        }

        $.ajax({
            type:"POST",
            url:"/hedging/updateHbtcAddress",
            data:$('#updateHbtcAddress').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success:function(result){
                location.replace(location);
            },
            error:function(){
                alert("Error !!")
            }
        })
    }

    function updateWethAddress(){
        $.ajax({
            type:"POST",
            url:"/hedging/updateWethAddress",
            data:$('#updateWethAddress').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success:function(result){
                location.replace(location);
            },
            error:function(){
                alert("Error !!")
            }
        })
    }


    function updateThreshold(){
        $.ajax({
            type:"POST",
            url:"/hedging/updateThreshold",
            data:$('#updateThreshold').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success:function(result){
                location.replace(location);
            },
            error:function(){
                alert("Error !!")
            }
        })
    }

    function updateProxy() {
        var proxyPort = document.getElementById("proxyPort").value;
        if (!proxyPort) {
            alert("The proxy port cannot be empty")
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/hedging/updateProxy",
            data: $('#updateProxy').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Please enter the correct agent port and address!!")
            }
        })
    }

    function updateExchangeApiKey(){
        $.ajax({
            type:"POST",
            url:"/hedging/updateExchangeApiKey",
            data:$('#updateExchangeApiKey').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success:function(result){
                location.replace(location);
            },
            error:function(){
                alert("Please enter the correct API-Key !!")
            }
        })
    }

    function updatePasswd() {
        let passwd = document.getElementById("userPasswd").value;
        if (!passwd) {
            alert("The password cannot be empty")
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/auth/update-passwd",
            data: $('#updatePasswd').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Please enter the correct node address!!")
            }
        })
    }

    function updateNode() {
        var node = document.getElementById("node").value;
        if (!node) {
            alert("The node cannot be empty")
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/hedging/updateNode",
            data: $('#updateNode').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Please enter the correct node address!!")
            }
        })
    }

    var node = '[[${node}]]';
    var address = '[[${address}]]';

    function updateInterval() {
        if (!node) {
            alert("Please set the node first");
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/hedging/updateInterval",
            data: $('#updateInterval').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Please enter the correct interval!!")
            }
        })
    }

    function updateAddress() {
        if (!node) {
            alert("Please set the node first");
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/hedging/updateAddress",
            data: $('#updateAddress').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Please enter the correct address!!")
            }
        })
    }

    function startHedging() {
        if (!node) {
            alert("Please set the node first");
            return false;
        }

        if (address == 'Please fill in the marketmaker account address') {
            alert("Please fill in the marketmaker account address");
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/hedging/start-hedging",
            data: $('').serialize(),
            beforeSend: function (xhr) {
                xhr.setRequestHeader('token', localStorage.getItem('token'));
            },
            success: function (result) {
                location.reload();
            },
            error: function () {
                alert("Error starting/closing!!")
            }
        })
    }
</script>

<style type="text/css">
    .bk {
        background-color: cadetblue;
        background-size: 100% 100%;
    }
</style>
</html>

